<h1 id="common-table-expressions-ie-ctes">Common Table Expressions (i.e. CTEs)</h1>
<p>Common Table Expressions (CTEs) allow you to create re-usable temporal result sets.</p>
<h2 id="with">with</h2>
<p>You can build a CTE using a function:</p>
<pre><code class="language-javascript">// qb
query.with( &quot;UserCTE&quot;, function ( q ) {
        q
            .select( [ &quot;fName as firstName&quot;, &quot;lName as lastName&quot; ] )
            .from( &quot;users&quot; )
            .where( &quot;disabled&quot;, 0 );
    } )
    .from( &quot;UserCTE&quot; )
    .get();</code></pre>
<h2 id="withrecursive">withRecursive</h2>
<pre><code class="language-javascript">query
.withRecursive( &quot;Hierarchy&quot;, function ( q ) {
    q.select( [ &quot;Id&quot;, &quot;ParentId&quot;, &quot;Name&quot;, q.raw( &quot;0 AS [Generation]&quot; ) ] )
        .from( &quot;Sample&quot; )
        .whereNull( &quot;ParentId&quot; )
        // use recursion to join the child rows to their parents
        .unionAll( function ( q ) {
            q.select( [
                    &quot;child.Id&quot;,
                    &quot;child.ParentId&quot;,
                    &quot;child.Name&quot;,
                    q.raw( &quot;[parent].[Generation] + 1&quot; )
                ] )
                .from( &quot;Sample as child&quot; )
                .join( &quot;Hierarchy as parent&quot;, &quot;child.ParentId&quot;, &quot;parent.Id&quot; );
        } );
    }, [ &quot;Id&quot;, &quot;ParentId&quot;, &quot;Name&quot;, &quot;Generation&quot; ] )
    .from( &quot;Hierarchy&quot; )
    .get();</code></pre>
